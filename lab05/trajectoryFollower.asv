classdef trajectoryFollower
    
    properties
        traj
        controller
    end
    
    methods
        function obj = trajectoryFollower(traj, controller)
            %UNTITLED9 Construct an instance of this class
            %   Detailed explanation goes here
            obj.traj = traj;
            obj.controller = controller;
        end
        
        function [refV, refw] = getRefVw(obj, t)
            %METHOD1 Summary of this method goes here
            %   Detailed explanation goes here
            refV = obj.traj.getVAtTime(t);
            refw = obj.traj.getwAtTime(t);
        end
        
        function refPose = getRefPose(obj, t)
            refPose = obj.traj.getPoseAtTime(t);
        end
        
        function realPose = getRealPose(obj)
            global rightEncoderDiff;
            global leftEncoderDiff;
            lDiff = leftEncoderDiff;
            rDiff = rightEncoderDiff;
            
            thetaChange = atan((lDiff - rDiff)/wheelbase);
            positionChange = (lDiff + rDiff)/2;
            
            theta = theta + thetaChange/2;
            x = x + positionChange*cos(theta);
            y = y + positionChange*sin(theta);
            theta = theta + thetaChange/2;
            realPose = [x;
                        y;
                        theta]
        end
        
        function [realV, realw] = getRealVw(obj, t)
            [realV, realw] = obj.getRefVw(t);
            if (isnan(realV))
                realV = 0;
            end
            if (isnan(realw))
                realw = 0;
            end
            [uv, uw] = obj.controller.error();
            realV = realV + uv;
            realw = realw + uw;
        end
        
    end
end

